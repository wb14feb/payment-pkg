!function(t){"use strict";class e{constructor(t={}){this.options={formSelector:"#paymentForm",submitButtonSelector:"#submitBtn",totalAmountSelector:"#totalAmount",selectedItemsSelector:"#selectedItems",paymentMethodCardSelector:".payment-method-card",selectedPaymentMethodSelector:"#selectedPaymentMethod",...t},this.form=document.querySelector(this.options.formSelector),this.submitBtn=document.querySelector(this.options.submitButtonSelector),this.totalAmount=document.querySelector(this.options.totalAmountSelector),this.selectedItemsContainer=document.querySelector(this.options.selectedItemsSelector),this.init()}init(){this.form?(this.initializePaymentMethods(),this.initializeFormSubmission(),this.initializeQuantityControls()):console.warn("Jinah Payment: Form not found")}initializePaymentMethods(){const t=document.querySelectorAll(this.options.paymentMethodCardSelector),e=document.querySelector(this.options.selectedPaymentMethodSelector);t.forEach(s=>{s.addEventListener("click",i=>{i.preventDefault(),t.forEach(t=>t.classList.remove("selected")),s.classList.add("selected"),e&&(e.value=s.dataset.method),this.submitBtn&&(this.submitBtn.disabled=!1),this.triggerEvent("paymentMethodSelected",{method:s.dataset.method,element:s})})})}initializeFormSubmission(){this.form.addEventListener("submit",t=>{if(t.preventDefault(),!this.validateForm())return;const e=this.getSelectedItems(),s=this.getSelectedPaymentMethod();if(!s)return void this.showAlert("Silakan pilih metode pembayaran.","warning");this.addItemsToForm(e),this.addPaymentMethodToForm(s),this.setLoadingState(!0),!1!==this.triggerEvent("beforeSubmit",{items:e,paymentMethod:s})?this.form.submit():this.setLoadingState(!1)})}initializeQuantityControls(){document.querySelectorAll("[data-quantity-action]").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();const e=t.dataset.quantityAction,s=t.closest(".quantity-control").querySelector('input[type="number"]');if(s){let t=parseInt(s.value)||1;const i=parseInt(s.min)||1,a=parseInt(s.max)||999;"increase"===e&&t<a?t++:"decrease"===e&&t>i&&t--,s.value=t,this.updateItemQuantity(s.dataset.itemId,t),this.calculateTotal()}})})}validateForm(){const t=this.form.querySelectorAll("[required]");let e=!0;return t.forEach(t=>{t.value.trim()?(t.classList.remove("is-invalid"),t.classList.add("is-valid")):(t.classList.add("is-invalid"),e=!1)}),e}getSelectedItems(){const t=[];return document.querySelectorAll("#selectedItems > div[data-item-id]").forEach(e=>{t.push({id:parseInt(e.dataset.itemId),quantity:parseInt(e.dataset.itemQuantity),price:parseFloat(e.dataset.itemPrice)})}),t}getSelectedPaymentMethod(){const t=document.querySelector(this.options.selectedPaymentMethodSelector);return t?t.value:null}addItemsToForm(t){this.form.querySelectorAll('input[name^="items["]').forEach(t=>t.remove()),t.forEach((t,e)=>{this.addHiddenInput(`items[${e}][id]`,t.id),this.addHiddenInput(`items[${e}][quantity]`,t.quantity)})}addPaymentMethodToForm(t){const e=this.form.querySelector('input[name="payment_method"]');e&&e.remove(),this.addHiddenInput("payment_method",t)}addHiddenInput(t,e){const s=document.createElement("input");s.type="hidden",s.name=t,s.value=e,this.form.appendChild(s)}updateItemQuantity(t,e){const s=document.querySelector(`[data-item-id="${t}"]`);s&&(s.dataset.itemQuantity=e)}calculateTotal(){const t=this.getSelectedItems();let e=0;t.forEach(t=>{e+=t.price*t.quantity});const s=document.querySelector("[data-discount]"),i=s?parseFloat(s.dataset.discount):0;e-=i,this.totalAmount&&(this.totalAmount.textContent=this.formatCurrency(e)),this.triggerEvent("totalCalculated",{total:e,discount:i})}formatCurrency(t){return"Rp. "+Math.round(t).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}setLoadingState(t){this.submitBtn&&(t?(this.submitBtn.disabled=!0,this.submitBtn.classList.add("btn-loading"),this.submitBtn.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i>Memproses...'):(this.submitBtn.disabled=!1,this.submitBtn.classList.remove("btn-loading"),this.submitBtn.innerHTML='<i class="fas fa-credit-card me-2"></i>Lanjutkan Pembayaran'))}showAlert(t,e="info"){const s=document.createElement("div");s.className=`alert alert-${e} alert-dismissible fade show`,s.innerHTML=`\n                ${t}\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            `,this.form.insertAdjacentElement("afterbegin",s),setTimeout(()=>{s.remove()},5e3)}triggerEvent(t,e={}){return this.form.dispatchEvent(new CustomEvent(`jinah:${t}`,{detail:e,bubbles:!0,cancelable:!0}))}}t.JinahPayment=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#paymentForm")&&(t.jinahPayment=new e)}):document.querySelector("#paymentForm")&&(t.jinahPayment=new e)}(window);
